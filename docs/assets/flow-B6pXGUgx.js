var V=Object.defineProperty;var W=(h,s,i)=>s in h?V(h,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[s]=i;var l=(h,s,i)=>(W(h,typeof s!="symbol"?s+"":s,i),i);import{d as b,r as G,G as A,j as U,e as X,f as Y,J as M,B as d,o as Z}from"./index-Dk52mj26.js";import{c as $}from"./simplex-noise-BtZ5wMFy.js";import{i as j}from"./initGUI-CcmszmDW.js";import{i as q}from"./initStats-z-qGLZo8.js";import"./dat.gui.module-DcMWPYuf.js";const Q=b({__name:"flow",setup(h){const s=$(),i=G(),u=G();let g=300,m=360,r=10,a=30,w=r*10,c=0,p=0,n,C=0,y=0,x=.001,O=.001,v=.004,z=!1;const o={hueBase:g,hueRange:m,lineWidth:r,cellSize:a,lineLen:w,xInc:x,yInc:O,zInc:v,isGlow:z};let S=0;return A(()=>{cancelAnimationFrame(S)}),U(()=>{function _(){const{width:t,height:e}=i.value.getBoundingClientRect();c=t,p=e,u.value.width=t,u.value.height=e,n=u.value.getContext("2d"),C=Math.ceil(e/a),y=Math.ceil(t/a),n.lineCap="round",n.lineWidth=r}_();const f=[];function R(){let t=null;return()=>{t&&clearTimeout(t),t=setTimeout(()=>{_(),f.length=0,B()},700)}}window.addEventListener("resize",R());function N(){const{gui:t}=j(i.value);t.add(o,"hueBase",1,360,1).onChange(e=>g=e),t.add(o,"hueRange",1,360,1).onChange(e=>m=e),t.add(o,"isGlow").name("isGlow(laggy)").onChange(e=>z=e),t.add(o,"cellSize",10,60,1).name("cellSize(careful)").onChange(e=>{a=e,f.length=0,C=Math.ceil(p/a),y=Math.ceil(c/a),B()}),t.add(o,"lineWidth",1,20,1).onChange(e=>{r=e,n.lineWidth=r}),t.add(o,"lineLen",1,200,1).onChange(e=>w=e),t.add(o,"xInc",.001,.01,.001).onChange(e=>x=e),t.add(o,"yInc",.001,.01,.001).onChange(e=>O=e),t.add(o,"zInc",.001,.01,.001).onChange(e=>v=e)}N();class E{constructor(e){l(this,"end",new M.Vector(0,0));l(this,"pos");l(this,"hue",0);l(this,"xOff",0);l(this,"yOff",0);l(this,"zOff",0);this.pos=e,this.xOff=d(e.x,0,c,0,1),this.yOff=d(e.y,0,c,0,1),this.zOff=d(Math.sqrt(this.xOff+this.yOff),0,2,0,1)}draw(){n.beginPath(),n.moveTo(this.pos.x,this.pos.y),n.lineTo(this.end.x,this.end.y);const{hsl:e,grad:I}=this.getColor();n.strokeStyle=I,z?(n.shadowColor=e,n.shadowBlur=r/2):n.shadowBlur=0,n.stroke()}getColor(){this.hue=Math.floor(d(this.getNoiseXYZ(),-1,1,g-m,g+m));const e=n.createLinearGradient(this.pos.x,this.pos.y,this.end.x,this.end.y);return e.addColorStop(0,`hsla(${this.hue}, 100%, 50%, 0)`),e.addColorStop(1,`hsla(${this.hue}, 100%, 50%, 1)`),{hsl:`hsla(${this.hue}, 100%, 50%, 1)`,grad:e}}getNoiseXYZ(){return s(this.xOff,this.yOff,this.zOff)}update(){const e=this.getNoiseXYZ(),I=d(e,-1,1,0,Math.PI*4),T=d(e,-1,1,.1,w);this.end=this.pos.copy().add(M.Vector.fromAngle(I,T)),this.xOff+=x,this.yOff+=O,this.zOff+=v}}function B(){for(let t=0;t<y;t++)for(let e=0;e<C;e++)f.push(new E(new M.Vector(t*a,e*a)))}const{stats:L}=q(i.value);function k(){L.update(),n.clearRect(0,0,c,p),n.fillStyle="rgba(0,0,0,1)",n.fillRect(0,0,c,p),f.forEach(t=>{t.update(),t.draw()}),S=requestAnimationFrame(k)}B(),k()}),(_,f)=>(Z(),X("div",{ref_key:"con",ref:i,class:"h-100vh w-full"},[Y("canvas",{ref_key:"canvas",ref:u,class:"h-full w-full block"},null,512)],512))}});export{Q as default};
