var W=Object.defineProperty;var D=(c,s,a)=>s in c?W(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a;var r=(c,s,a)=>(D(c,typeof s!="symbol"?s+"":s,a),a);import{d as G,r as I,C as J,h as K,E as O,o as Q,b as Z,O as q,T as H,aB as V,N as X,Q as k,U as Y}from"./index-4DVSqO0R.js";import{c as $}from"./chroma-eh7xmDAu.js";import{i as tt}from"./initThree-pObuZXUG.js";import{p as et}from"./dotTexture-mhtNNgxL.js";import"./OrbitControls-L9M54DP_.js";import"./initStats-RmPhGrq2.js";const st="/nova/assets/particleLife-KJ-eymif.ts",ut=G({__name:"particleLife",setup(c){const s=new Worker(st),{PI:a,min:v,atan:x}=Math,f=I(),l=8,u=100,B=l*u,C=$.scale(["#00b894","#0984e3","#6c5ce7","#fdcb6e","#e84393"]);return J(()=>{s.postMessage("close"),s.terminate()}),K(async()=>{const{width:p,height:d}=f.value.getBoundingClientRect(),{scene:b,camera:h,renderWrap:F}=tt(f.value,!0,!1,!1),w=p,_=d,M=6,U=.8,z=v(p,d)/30,m=M*4,y=z*5,N=.5;async function L(){return new Promise(g=>{s.postMessage({tag:"init_settings",data:{typeNum:l,typeParticleNum:u,width:p,height:d,xRange:w,yRange:_,frictionFactor:U,distMin:m,distMax:y,forceFactor:N}}),s.onmessage=t=>{t.data.tag==="init_settings_done"&&(console.log("init_settings_done"),g(1))}})}await L(),b.background=new O(0);const P=800;h.position.set(w/2,_/2,P),h.aspect=p/d,h.fov=x(d/2/P)*2/a*180,h.lookAt(w/2,_/2,0),h.updateProjectionMatrix();class R{constructor(t,o){r(this,"positions");r(this,"colors");r(this,"types");r(this,"geo",new q);r(this,"mat",new H({size:M,map:new V().load(et),blending:X,transparent:!1,sizeAttenuation:!0,vertexColors:!0}));r(this,"mesh");this.positions=new Float32Array(l*u*3),this.types=new Float32Array(l*u);for(let e=0;e<t.length;e++)this.positions[e]=t[e];for(let e=0;e<o.length;e++)this.types[e]=o[e];this.positions=t,this.types=o,this.colors=new Float32Array(B*3),this.geo.setAttribute("position",new k(this.positions,3)),this.geo.setAttribute("color",new k(this.colors,3));for(let e=0;e<l;e++)for(let n=0;n<u;n++){const i=e*u+n,[T,j,E]=C(e/l).gl();this.colors[i*3]=T,this.colors[i*3+1]=j,this.colors[i*3+2]=E}this.mesh=new Y(this.geo,this.mat),this.mesh.geometry.attributes.position.needsUpdate=!0,b.add(this.mesh)}accelatorForce(t,o){return t<=m?t/m-1:t<y?(t-m)/(y-m)*o:0}getPos(t){return[this.positions[3*t],this.positions[3*t+1],this.positions[3*t+2]]}async update(){return new Promise(t=>{s.postMessage({tag:"update_cloud"}),s.onmessage=o=>{const{data:e}=o.data;if(o.data.tag==="update_cloud_done"){const{positions:n}=e;for(let i=0;i<n.length;i++)this.positions[i]=n[i];t(1)}}})}draw(){this.mesh.geometry.attributes.position.needsUpdate=!0,this.mesh.geometry.attributes.color.needsUpdate=!0}}async function S(){return s.postMessage({tag:"init_cloud"}),new Promise(g=>{s.onmessage=t=>{if(t.data.tag==="init_cloud_done"){const{positions:o,types:e}=t.data.data,n=new R(o,e);console.log("init_cloud_done"),g(n)}}})}const A=await S();F(()=>{A.update(),A.draw()})()}),(p,d)=>(Q(),Z("div",{ref_key:"con",ref:f,class:"w-full h-full"},null,512))}});export{ut as default};
