import{G as A}from"./dat.gui.module-PWGADmkp.js";import{d as D,r as b,h as W,a7 as z,E as B,ay as S,M as H,V,aK as O,S as I,P as F,W as Y,H as K,I as $,o as q,b as J,e as C,aO as Q}from"./index-somVfJ8D.js";import{O as X}from"./OrbitControls-Qre0769Z.js";import{R as Z,E as P,S as j}from"./RenderPass-O0m3L7Ps.js";import{U as ee}from"./UnrealBloomPass-vT1pH19_.js";const ie=D({__name:"GlowBall",setup(ne){const M=b(),_=b();let c=window.innerWidth,m=window.innerHeight,h,l,o,t,i,r,w;const p=1,g=0;W(()=>{T(),U(),E(),G(),d()});const a={exposure:1,bloomStrength:5,bloomThreshold:0,bloomRadius:0,scene:"normalAndGlow"},x=b();function T(){var s;const e=new A({autoPlace:!1});(s=x.value)==null||s.append(e.domElement),e.add(a,"exposure",.1,2).onChange(n=>{t.toneMappingExposure=n**4,d()}),e.add(a,"bloomThreshold",0,1).onChange(n=>{i.threshold=Number(n),d()}),e.add(a,"bloomStrength",0,10).onChange(n=>{i.strength=Number(n),d()}),e.add(a,"bloomRadius",0,1,.001).onChange(n=>{i.radius=Number(n),d()}),e.add(a,"scene",["normalAndGlow","onlyNnormal","onlyGlow"]).onChange(n=>{a.scene=n,d()})}function E(){const e=new z(1,15);for(let s=0;s<50;s++){const n=new B;n.setHSL(Math.random(),.7,.3);const v=new S({color:n}),u=new H(e,v);u.position.x=Math.random()*10-5,u.position.y=Math.random()*10-5,u.position.z=Math.random()*10-5,u.scale.setScalar(Math.random()*Math.random()+.5),u.layers.enable(s%2===0?p:g),l.add(u)}}function G(){const e=`varying vec2 vUv;
  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
  `,s=`uniform sampler2D baseTexture;
  uniform sampler2D bloomTexture;
  varying vec2 vUv;
  void main() {
    gl_FragColor = ( texture2D( baseTexture, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );
  }
  `,n=new Z(l,o);i=new ee(new V(window.innerWidth,window.innerHeight),1.5,.4,.85),i.threshold=a.bloomThreshold,i.strength=a.bloomStrength,i.radius=a.bloomRadius,r=new P(t),r.addPass(n),r.addPass(i);const v=new j(new O({uniforms:{baseTexture:{value:null},bloomTexture:{value:r.renderTarget2.texture}},vertexShader:e,fragmentShader:s,defines:{}}),"baseTexture");v.needsSwap=!0,w=new P(t),w.addPass(n),w.addPass(v)}function d(){const{scene:e}=a;e==="onlyNnormal"?(o.layers.set(g),t.render(l,o)):e==="onlyGlow"?(o.layers.set(p),r.renderToScreen=!0,r.render(),o.layers.set(g)):e==="normalAndGlow"&&(r.renderToScreen=!1,l.traverse(R),r.render(),l.traverse(k),w.render())}const f={},L=new S({color:"black"}),y=new Q;y.set(p);function R(e){e.isMesh&&y.test(e.layers)===!1&&(f[e.uuid]=e.material,e.material=L)}function k(e){f[e.uuid]&&(e.material=f[e.uuid],delete f[e.uuid])}function U(){l=new I,o=new F(75,c/m,.1,1e3),t=new Y({canvas:M.value,antialias:!0}),t.setSize(c,m),window.addEventListener("resize",N),l.add(new K(4210752)),h=new X(o,t.domElement),h.target=new $(0,0,0),h.object.position.set(10,10,10),h.update(),h.addEventListener("change",d)}function N(){c=window.innerWidth,m=window.innerHeight,o.aspect=c/m,o.updateProjectionMatrix(),t.setSize(c,m),r.setSize(c,m)}return(e,s)=>(q(),J("div",{ref_key:"con",ref:x,class:""},[C("div",{ref_key:"canvasCon",ref:_,class:"canvasCon"},[C("canvas",{ref_key:"canvasDom",ref:M,class:"canvas"},null,512)],512)],512))}});export{ie as default};
