var V=Object.defineProperty;var W=(h,o,i)=>o in h?V(h,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[o]=i;var l=(h,o,i)=>(W(h,typeof o!="symbol"?o+"":o,i),i);import{p as M}from"./p5.min-4aqVLu6D.js";import{c as b}from"./simplex-noise-BtZ5wMFy.js";import{i as A}from"./initGUI-CcmszmDW.js";import{d as U,r as R,E as X,j as Y,J as Z,e as $,f as j,o as q}from"./index-C5HxIGZc.js";import{m as d}from"./math-DDaBGwiJ.js";import"./dat.gui.module-DcMWPYuf.js";const ee=U({__name:"flow",setup(h){const o=b(),i=R(),u=R();let g=300,m=360,r=10,a=30,w=r*10,c=0,p=0,n,C=0,y=0,x=.001,O=.001,v=.004,z=!1;const s={hueBase:g,hueRange:m,lineWidth:r,cellSize:a,lineLen:w,xInc:x,yInc:O,zInc:v,isGlow:z};let S=0;return X(()=>{cancelAnimationFrame(S)}),Y(()=>{function _(){const{width:t,height:e}=i.value.getBoundingClientRect();c=t,p=e,u.value.width=t,u.value.height=e,n=u.value.getContext("2d"),C=Math.ceil(e/a),y=Math.ceil(t/a),n.lineCap="round",n.lineWidth=r}_();const f=[];function E(){let t=null;return()=>{t&&clearTimeout(t),t=setTimeout(()=>{_(),f.length=0,I()},700)}}window.addEventListener("resize",E());function G(){const{gui:t}=A(i.value);t.add(s,"hueBase",1,360,1).onChange(e=>g=e),t.add(s,"hueRange",1,360,1).onChange(e=>m=e),t.add(s,"isGlow").name("isGlow(laggy)").onChange(e=>z=e),t.add(s,"cellSize",10,60,1).name("cellSize(careful)").onChange(e=>{a=e,f.length=0,C=Math.ceil(p/a),y=Math.ceil(c/a),I()}),t.add(s,"lineWidth",1,20,1).onChange(e=>{r=e,n.lineWidth=r}),t.add(s,"lineLen",1,200,1).onChange(e=>w=e),t.add(s,"xInc",.001,.01,.001).onChange(e=>x=e),t.add(s,"yInc",.001,.01,.001).onChange(e=>O=e),t.add(s,"zInc",.001,.01,.001).onChange(e=>v=e)}G();class N{constructor(e){l(this,"end",new M.Vector(0,0));l(this,"pos");l(this,"hue",0);l(this,"xOff",0);l(this,"yOff",0);l(this,"zOff",0);this.pos=e,this.xOff=d(e.x,0,c,0,1),this.yOff=d(e.y,0,c,0,1),this.zOff=d(Math.sqrt(this.xOff+this.yOff),0,2,0,1)}draw(){n.beginPath(),n.moveTo(this.pos.x,this.pos.y),n.lineTo(this.end.x,this.end.y);const{hsl:e,grad:B}=this.getColor();n.strokeStyle=B,z?(n.shadowColor=e,n.shadowBlur=r/2):n.shadowBlur=0,n.stroke()}getColor(){this.hue=Math.floor(d(this.getNoiseXYZ(),-1,1,g-m,g+m));const e=n.createLinearGradient(this.pos.x,this.pos.y,this.end.x,this.end.y);return e.addColorStop(0,`hsla(${this.hue}, 100%, 50%, 0)`),e.addColorStop(1,`hsla(${this.hue}, 100%, 50%, 1)`),{hsl:`hsla(${this.hue}, 100%, 50%, 1)`,grad:e}}getNoiseXYZ(){return o(this.xOff,this.yOff,this.zOff)}update(){const e=this.getNoiseXYZ(),B=d(e,-1,1,0,Math.PI*4),T=d(e,-1,1,.1,w);this.end=this.pos.copy().add(M.Vector.fromAngle(B,T)),this.xOff+=x,this.yOff+=O,this.zOff+=v}}function I(){for(let t=0;t<y;t++)for(let e=0;e<C;e++)f.push(new N(new M.Vector(t*a,e*a)))}const{stats:L}=Z(i.value);function k(){L.update(),n.clearRect(0,0,c,p),n.fillStyle="rgba(0,0,0,1)",n.fillRect(0,0,c,p),f.forEach(t=>{t.update(),t.draw()}),S=requestAnimationFrame(k)}I(),k()}),(_,f)=>(q(),$("div",{ref_key:"con",ref:i,class:"h-100vh w-full"},[j("canvas",{ref_key:"canvas",ref:u,class:"h-full w-full block"},null,512)],512))}});export{ee as default};
